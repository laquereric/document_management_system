<% content_for :title, "Documents" %>

<%= render(Layout::PageContent.new(padding: :none)) do %>
  <!-- Page Header -->
  <%= render(Layout::PageHeader.new(
    title: "Documents",
    description: "Manage and organize your documents",
    icon: "file-text",
    action: {
      text: "New Document",
      url: new_document_path
    }
  )) %>

  <!-- Statistics Cards -->
  <%= render(Layout::StatisticsGrid.new(
    title: "Document Overview",
    statistics: [
      {
        title: "Total Documents",
        value: @documents.respond_to?(:total_count) ? @documents.total_count : @documents.count,
        icon: "file-text",
        color: "accent"
      },
      {
        title: "Pending Review",
        value: Document.joins(:status).where(statuses: { name: ['Pending', 'Draft', 'In Progress'] }).count,
        icon: "clock",
        color: "attention"
      },
      {
        title: "Published",
        value: Document.joins(:status).where(statuses: { name: ['Published', 'Approved', 'Active'] }).count,
        icon: "check-circle",
        color: "success"
      },
      {
        title: "This Week",
        value: Document.where('created_at >= ?', 7.days.ago).count,
        icon: "calendar",
        color: "done"
      }
    ]
  )) %>

  <!-- Search and Filters -->
  <%= render(Layout::SearchSection.new) do %>
    <% if defined?(Document) %>
      <% q = Document.ransack(params[:q]) %>
      <%= render(Search::SearchFormComponent.new(q: q)) %>
    <% end %>
  <% end %>

  <!-- Documents Section -->
  <%= render(Layout::ContentSection.new(
    title: "All Documents",
    count: @documents.respond_to?(:total_count) ? @documents.total_count : nil,
    controls: render(Layout::SortDropdown.new(
      current_sort: params[:sort],
      sort_options: [
        { label: "Sort by Date", value: nil },
        { label: "Sort by Title", value: "title" },
        { label: "Sort by Status", value: "status" }
      ],
      base_url: documents_path
    ))
  )) do %>
    <% if @documents&.any? %>
      <%= render(Layout::DocumentGrid.new(documents: @documents)) %>

      <!-- Pagination -->
      <% if @documents.respond_to?(:current_page) %>
        <%= render(Layout::CardListPagination.new(collection: @documents)) %>
      <% end %>
    <% else %>
      <%= render(Ui::EmptyStateComponent.new(
        title: "No Documents Found",
        description: "Get started by creating your first document.",
        icon: "file-text",
        action: {
          text: "Create Document",
          url: new_document_path
        }
      )) %>
    <% end %>
  <% end %>
<% end %>
