<div class="container-lg px-3 py-6">
  <!-- Header -->
  <div class="d-flex flex-items-center flex-justify-between mb-4">
    <div>
      <h1 class="h2 mb-1"><%= @user.name %></h1>
      <p class="text-gray">User profile and account details</p>
    </div>
    <div class="d-flex gap-2">
      <%= link_to models_edit_user_path(@user), class: "btn btn-outline" do %>
        <svg class="octicon octicon-pencil mr-2" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25a1.75 1.75 0 01.445-.758l8.61-8.61zm1.414 1.06a.25.25 0 00-.354 0L10.811 3.75l1.439 1.44 1.263-1.263a.25.25 0 000-.354l-1.086-1.086zM11.189 6.25L9.75 4.81l-6.286 6.287a.25.25 0 00-.064.108l-.558 1.953 1.953-.558a.249.249 0 00.108-.064l6.286-6.286z"/>
        </svg>
        Edit User
      <% end %>
      <%= link_to models_user_path(@user),
          method: :delete,
          data: { confirm: "Are you sure you want to delete this user? This action cannot be undone." },
          class: "btn btn-danger" do %>
        <svg class="octicon octicon-trash mr-2" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
          <path d="M10.5 4.5a.75.75 0 00-1.5 0v1h-3v-1a.75.75 0 00-1.5 0v1h-2.25a.75.75 0 000 1.5H2v8.25c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 15.25V7h.75a.75.75 0 000-1.5H12.5v-1zM11 7v8.25a.25.25 0 01-.25.25h-8.5A.25.25 0 013 15.25V7h8z"/>
        </svg>
        Delete User
      <% end %>
    </div>
  </div>

  <div class="row g-4">
    <!-- User Information -->
    <div class="col-12 col-lg-8">
      <div class="Box">
        <div class="Box-header">
          <h3 class="Box-title">User Information</h3>
        </div>
        <div class="Box-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <div class="form-group">
                <label class="form-label">Name</label>
                <div class="form-control-plaintext"><%= @user.name %></div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="form-group">
                <label class="form-label">Email</label>
                <div class="form-control-plaintext"><%= @user.email %></div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="form-group">
                <label class="form-label">Role</label>
                <div class="form-control-plaintext">
                  <span class="Label Label--<%= @user.role == 'admin' ? 'danger' : (@user.role == 'team_leader' ? 'warning' : 'secondary') %>">
                    <%= @user.role.titleize %>
                  </span>
                  <% unless @user == current_user %>
                    <%= link_to "Toggle Role", models_toggle_role_user_path(@user), 
                        method: :patch, 
                        class: "btn btn-sm btn-outline ml-2",
                        data: { confirm: "Are you sure you want to change this user's role?" } %>
                  <% end %>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="form-group">
                <label class="form-label">Organization</label>
                <div class="form-control-plaintext">
                  <% if @user.organization %>
                    <%= link_to @user.organization.name, models_organization_path(@user.organization) %>
                  <% else %>
                    <span class="color-fg-muted">None</span>
                  <% end %>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="form-group">
                <label class="form-label">Account Created</label>
                <div class="form-control-plaintext"><%= @user.created_at.strftime("%B %d, %Y at %I:%M %p") %></div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="form-group">
                <label class="form-label">Last Updated</label>
                <div class="form-control-plaintext"><%= @user.updated_at.strftime("%B %d, %Y at %I:%M %p") %></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- User Statistics -->
      <div class="Box mt-4">
        <div class="Box-header">
          <h3 class="Box-title">Statistics</h3>
        </div>
        <div class="Box-body">
          <div class="row g-4">
            <div class="col-12 col-md-6 col-lg-3">
              <div class="d-flex flex-column align-items-center text-center">
                <div class="CircleBadge CircleBadge--large bg-blue mb-2">
                  <svg class="octicon octicon-group" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="20" height="20">
                    <path d="M2 5.5a3.5 3.5 0 1 1 5.898 2.549 5.508 5.508 0 0 1 3.034 4.084.75.75 0 1 1-1.482.235 4.001 4.001 0 0 0-7.9 0 .75.75 0 0 1-1.482-.236A5.507 5.507 0 0 1 3.102 8.05 3.493 3.493 0 0 1 2 5.5ZM11 4a3.001 3.001 0 0 1 2.22 5.018 5.01 5.01 0 0 1 2.56 3.012.749.749 0 0 1-.885.954.752.752 0 0 1-.665-.57 3.51 3.51 0 0 0-2.522-2.372.75.75 0 0 1-.574-.73v-.352a.75.75 0 0 1 .416-.672A1.5 1.5 0 0 0 11 4Zm-5.5 1.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4ZM9.5 6a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"></path>
                  </svg>
                </div>
                <div class="h3 mb-1"><%= @user.teams.count %></div>
                <div class="color-fg-muted">Teams</div>
              </div>
            </div>
            <div class="col-12 col-md-6 col-lg-3">
              <div class="d-flex flex-column align-items-center text-center">
                <div class="CircleBadge CircleBadge--large bg-green mb-2">
                  <svg class="octicon octicon-file-text" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="20" height="20">
                    <path d="M3.75 1.5a.25.25 0 0 0-.25.25v11.5c0 .138.112.25.25.25h8.5a.25.25 0 0 0 .25-.25V6H9.75A1.75 1.75 0 0 1 8 4.25V1.5H3.75Zm5.75.56v2.19c0 .138.112.25.25.25h2.19L9.5 2.06ZM2 1.75C2 .784 2.784 0 3.75 0h5.086c.464 0 .909.184 1.237.513l3.414 3.414c.329.328.513.773.513 1.237v8.086A1.75 1.75 0 0 1 12.25 15h-8.5A1.75 1.75 0 0 1 2 13.25V1.75Z"></path>
                  </svg>
                </div>
                <div class="h3 mb-1"><%= @user.authored_documents.count %></div>
                <div class="color-fg-muted">Documents</div>
              </div>
            </div>
            <div class="col-12 col-md-6 col-lg-3">
              <div class="d-flex flex-column align-items-center text-center">
                <div class="CircleBadge CircleBadge--large bg-purple mb-2">
                  <svg class="octicon octicon-pulse" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="20" height="20">
                    <path d="M6 2c.306 0 .582.187.696.471L10 10.731l1.304-3.26A.751.751 0 0 1 12 7h3.25a.75.75 0 0 1 0 1.5h-2.742l-1.812 4.528a.751.751 0 0 1-1.392 0L6 4.77 4.696 8.03A.75.75 0 0 1 4 8.75H.75a.75.75 0 0 1 0-1.5h2.742l1.812-4.529A.751.751 0 0 1 6 2Z"></path>
                  </svg>
                </div>
                <div class="h3 mb-1"><%= @user.activities.count %></div>
                <div class="color-fg-muted">Activities</div>
              </div>
            </div>
            <div class="col-12 col-md-6 col-lg-3">
              <div class="d-flex flex-column align-items-center text-center">
                <div class="CircleBadge CircleBadge--large bg-orange mb-2">
                  <svg class="octicon octicon-calendar" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="20" height="20">
                    <path d="M4.75 0a.75.75 0 0 1 .75.75V2h5V.75a.75.75 0 0 1 1.5 0V2h1.25c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 13.25 16H2.75A1.75 1.75 0 0 1 1 14.25V3.75C1 2.784 1.784 2 2.75 2H4V.75A.75.75 0 0 1 4.75 0ZM3.5 3.75v10.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25V3.75a.25.25 0 0 0-.25-.25H3.75a.25.25 0 0 0-.25.25ZM6 6.75A.75.75 0 0 1 6.75 6h2.5a.75.75 0 0 1 0 1.5h-2.5A.75.75 0 0 1 6 6.75ZM6 9.75A.75.75 0 0 1 6.75 9h2.5a.75.75 0 0 1 0 1.5h-2.5A.75.75 0 0 1 6 9.75ZM6.75 12a.75.75 0 0 0 0 1.5h2.5a.75.75 0 0 0 0-1.5h-2.5Z"></path>
                  </svg>
                </div>
                <div class="h3 mb-1"><%= time_ago_in_words(@user.created_at) %></div>
                <div class="color-fg-muted">Days Active</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="col-12 col-lg-4">
      <!-- Teams -->
      <div class="Box mb-4">
        <div class="Box-header">
          <h3 class="Box-title">Teams</h3>
        </div>
        <div class="Box-body">
          <% if @user.teams.any? %>
            <div class="list-style-none">
              <% @user.teams.each do |team| %>
                <div class="d-flex flex-items-center py-2">
                  <div class="flex-shrink-0">
                    <div class="CircleBadge CircleBadge--small bg-blue">
                      <svg class="octicon octicon-group" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="12" height="12">
                        <path d="M2 5.5a3.5 3.5 0 1 1 5.898 2.549 5.508 5.508 0 0 1 3.034 4.084.75.75 0 1 1-1.482.235 4.001 4.001 0 0 0-7.9 0 .75.75 0 0 1-1.482-.236A5.507 5.507 0 0 1 3.102 8.05 3.493 3.493 0 0 1 2 5.5ZM11 4a3.001 3.001 0 0 1 2.22 5.018 5.01 5.01 0 0 1 2.56 3.012.749.749 0 0 1-.885.954.752.752 0 0 1-.665-.57 3.51 3.51 0 0 0-2.522-2.372.75.75 0 0 1-.574-.73v-.352a.75.75 0 0 1 .416-.672A1.5 1.5 0 0 0 11 4Zm-5.5 1.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4ZM9.5 6a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"></path>
                      </svg>
                    </div>
                  </div>
                  <div class="flex-auto ml-3">
                    <%= link_to team.name, models_team_path(team), class: "Link--primary" %>
                    <div class="color-fg-muted f6"><%= team.organization&.name %></div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="color-fg-muted">No teams assigned</p>
          <% end %>
        </div>
      </div>

      <!-- Role Management -->
      <% if current_user.admin? && @user != current_user %>
        <div class="Box mb-4">
          <div class="Box-header">
            <h3 class="Box-title">Role Management</h3>
          </div>
          <div class="Box-body">
            <div class="d-flex flex-items-center justify-content-between">
              <div>
                <strong>Current Role:</strong> 
                <span class="Label Label--<%= @user.admin? ? 'danger' : 'secondary' %>">
                  <%= @user.admin? ? 'Admin' : 'User' %>
                </span>
              </div>
              <%= link_to models_toggle_role_user_path(@user),
                  method: :patch,
                  class: "btn btn-sm btn-outline",
                  data: { confirm: "Are you sure you want to change this user's role?" } do %>
                <svg class="octicon octicon-arrow-switch mr-2" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M7.78 12.53a.75.75 0 01-1.06 0L2.47 8.28a.75.75 0 010-1.06l4.25-4.25a.75.75 0 011.06 1.06L4.81 7h7.44a.75.75 0 010 1.5H4.81l2.97 2.97a.75.75 0 010 1.06z"/>
                </svg>
                Toggle Role
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Recent Activity -->
      <div class="Box">
        <div class="Box-header d-flex flex-items-center flex-justify-between">
          <h3 class="Box-title">Recent Activity</h3>
          <%= link_to models_activities_path, class: "btn btn-sm btn-outline" do %>
            View All
          <% end %>
        </div>
        <div class="Box-body">
          <% recent_activity = @user.activities.includes(:document).order(created_at: :desc).limit(5) %>
          <% if recent_activity.any? %>
            <div class="list-style-none">
              <% recent_activity.each do |activity| %>
                <div class="py-2">
                  <div class="d-flex flex-items-center">
                    <div class="flex-shrink-0">
                      <svg class="octicon octicon-<%= activity.action == 'created' ? 'plus' : (activity.action == 'updated' ? 'pencil' : 'trash') %>" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
                        <% if activity.action == 'created' %>
                          <path d="M8 4a.75.75 0 0 1 .75.75v2.5h2.5a.75.75 0 0 1 0 1.5h-2.5v2.5a.75.75 0 0 1-1.5 0v-2.5h-2.5a.75.75 0 0 1 0-1.5h2.5v-2.5A.75.75 0 0 1 8 4Z"></path>
                        <% elsif activity.action == 'updated' %>
                          <path d="M11.013 1.427a1.75 1.75 0 0 1 2.474 0l1.086 1.086a1.75 1.75 0 0 1 0 2.474l-.897.897a.75.75 0 0 1-.53.22H13.25a.75.75 0 0 1-.75-.75v-1.5a.75.75 0 0 0-.75-.75h-1.5a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 1-.75.75H9.5a.75.75 0 0 1-.53-.22l-.897-.897a1.75 1.75 0 0 1 0-2.474l1.086-1.086ZM6.463 1.076a.25.25 0 0 1 .354 0l1.086 1.086a.25.25 0 0 1 0 .354L6.463 4.463a.25.25 0 0 1-.354 0L4.987 3.377a.25.25 0 0 1 0-.354L6.463 1.076ZM2.853.439a1.75 1.75 0 0 1 2.474 0L6.177 2.853A.25.25 0 0 1 6.5 3.207v1.5a.75.75 0 0 0 .75.75h1.5a.75.75 0 0 0 .75-.75v-1.5a.25.25 0 0 1 .323-.354L9.673 3.439a1.75 1.75 0 0 1 2.474 0l.897.897a.75.75 0 0 1 .22.53v1.25a.75.75 0 0 1-.75.75H12.5a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5a.75.75 0 0 0-.75-.75H8.5a.75.75 0 0 1-.75-.75V4.866a.75.75 0 0 1 .22-.53l.897-.897ZM2.22 7.47a.75.75 0 0 1 .22.53v1.25a.75.75 0 0 0 .75.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5a.75.75 0 0 0-.75-.75H2.5a.75.75 0 0 1-.75-.75V8.866a.75.75 0 0 1 .22-.53l.897-.897a1.75 1.75 0 0 1 2.474 0l.897.897ZM.439 9.147a.25.25 0 0 1 .354 0L2.853 10.56a.25.25 0 0 1 0 .354L.439 12.853a.25.25 0 0 1-.354 0L.147 12.147a.25.25 0 0 1 0-.354L.439 9.147ZM.439 12.853a1.75 1.75 0 0 1 2.474 0l.897.897a.75.75 0 0 1 .22.53v1.25a.75.75 0 0 0 .75.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5a.75.75 0 0 0-.75-.75H2.5a.75.75 0 0 1-.75-.75v-1.25a.75.75 0 0 1 .22-.53l.897-.897a1.75 1.75 0 0 1 2.474 0l.897.897ZM.439 15.147a.25.25 0 0 1 .354 0L2.853 16.56a.25.25 0 0 1 0 .354L.439 18.853a.25.25 0 0 1-.354 0L.147 18.147a.25.25 0 0 1 0-.354L.439 15.147Z"></path>
                        <% else %>
                          <path d="M6.5 1.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1-.75-.75v-1.5ZM2 1.75C2 .784 2.784 0 3.75 0h1.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-.75.75H3.75a.75.75 0 0 0-.75.75v8.5c0 .414.336.75.75.75h8.5a.75.75 0 0 0 .75-.75v-1.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.5A1.75 1.75 0 0 1 13.25 13h-8.5A1.75 1.75 0 0 1 3 11.25v-8.5C3 1.784 3.784 1 4.75 1h1.5ZM1 11.25a2.75 2.75 0 0 0 2.75 2.75h8.5A2.75 2.75 0 0 0 15 11.25v-8.5A2.75 2.75 0 0 0 12.25 0h-8.5A2.75 2.75 0 0 0 1 2.75v8.5ZM11 2a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 11 2ZM5.75 2a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 5.75 2ZM5 5.75a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5A.75.75 0 0 1 5 5.75ZM5.75 7a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-4.5ZM5 10.75a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5A.75.75 0 0 1 5 10.75Z"></path>
                        <% end %>
                      </svg>
                    </div>
                    <div class="flex-auto ml-2">
                      <div class="f6">
                        <%= activity.action %> 
                        <% if activity.document %>
                          <%= link_to activity.document.title, models_document_path(activity.document), class: "Link--primary" %>
                        <% end %>
                      </div>
                      <div class="color-fg-muted f6"><%= time_ago_in_words(activity.created_at) %> ago</div>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="color-fg-muted">No recent activity</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
