<% content_for :title, "Documents" %>

<%= render(Layout::Page::PageContent.new(padding: :none)) do %>
  <!-- Page Header -->
  <%= render(Layout::Page::PageHeader.new(
    title: "Documents",
    description: "Manage and organize your documents",
    icon: "file-text",
    action: {
      text: "New Document",
      url: models_new_document_path
    }
  )) %>

  <!-- Statistics Cards -->
      <%= render(Layout::CardList::Statistics::StatisticsGridComponent.new(
    title: "Document Overview",
    statistics: [
      {
        title: "Total Documents",
        value: @documents.respond_to?(:total_count) ? @documents.total_count : @documents.count,
        icon: "file-text",
        color: "accent"
      },
      {
        title: "Pending Review",
        value: Document.joins(:status).where(statuses: { name: ['Pending', 'Draft', 'In Progress'] }).count,
        icon: "clock",
        color: "attention"
      },
      {
        title: "Published",
        value: Document.joins(:status).where(statuses: { name: ['Published', 'Approved', 'Active'] }).count,
        icon: "check-circle",
        color: "success"
      },
      {
        title: "This Week",
        value: Document.where('created_at >= ?', 7.days.ago).count,
        icon: "calendar",
        color: "done"
      }
    ]
  )) %>

  <!-- Search and Filters -->
          <%= render(Layout::CardList::SearchFilterSort::SearchSectionComponent.new) do %>
    <% if defined?(Document) %>
      <% q = Document.ransack(params[:q]) %>
      <%= render(Layout::Navigation::Search::SearchFormComponent.new(q: q)) %>
    <% end %>
  <% end %>

  <!-- Documents Section -->
  <div class="mt-5">
    <div class="d-flex flex-items-center flex-justify-between mb-3">
      <h2 class="f4 text-semibold">
        All Documents
        <% if @documents.respond_to?(:total_count) && @documents.total_count %>
          <span class="Counter"><%= @documents.total_count %></span>
        <% end %>
      </h2>
      <div class="d-flex flex-items-center gap-2">
        <%= render(Layout::CardList::SearchFilterSort::SortDropdownComponent.new(
          current_sort: params[:sort],
          sort_options: [
            { label: "Sort by Date", value: nil },
            { label: "Sort by Title", value: "title" },
            { label: "Sort by Status", value: "status" }
          ],
          base_url: models_documents_path
        )) %>
      </div>
    </div>

    <div class="Box">
      <div class="Box-body">
        <% if @documents&.any? %>
          <%= render(Layout::CardList::DocumentGrid.new(documents: @documents)) %>

          <!-- Pagination -->
          <% if @documents.respond_to?(:current_page) %>
            <%= render(Layout::CardList::Pagination::PaginationComponent.new(collection: @documents)) %>
          <% end %>
        <% else %>
          <%= render(Ui::EmptyStateComponent.new(
            title: "No Documents Found",
            description: "Get started by creating your first document.",
            icon: "file-text",
            action: {
              text: "Create Document",
              url: models_new_document_path
            }
          )) %>
        <% end %>
      </div>
    </div>
  </div>
<% end %>
