<% content_for :title, "Manage Users" %>

<div class="container-lg px-3">
  <!-- Page Header -->
  <div class="d-flex flex-items-center flex-justify-between py-4 border-bottom">
    <div class="d-flex flex-items-center">
      <svg class="octicon octicon-people mr-2 color-fg-accent" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="24" height="24">
        <path d="M2 5.5a3.5 3.5 0 1 1 5.898 2.549 5.508 5.508 0 0 1 3.034 4.084.75.75 0 1 1-1.482.235 4.001 4.001 0 0 0-7.9 0 .75.75 0 0 1-1.482-.236A5.507 5.507 0 0 1 3.102 8.05 3.493 3.493 0 0 1 2 5.5ZM11 4a3.001 3.001 0 0 1 2.22 5.018 5.01 5.01 0 0 1 2.56 3.012.749.749 0 0 1-.885.954.752.752 0 0 1-.665-.57 3.51 3.51 0 0 0-2.522-2.372.75.75 0 0 1-.574-.73v-.352a.75.75 0 0 1 .416-.672A1.5 1.5 0 0 0 11 4Zm-5.5 1.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4ZM9.5 6a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"></path>
      </svg>
      <div>
        <h1 class="f2 lh-condensed text-semibold mb-1">Manage Users</h1>
        <p class="f5 color-fg-muted mb-0">Admin user management and role control</p>
      </div>
    </div>
    <div class="d-flex flex-items-center" style="gap: 8px;">
      <%= link_to new_admin_user_path, class: "btn btn-primary" do %>
        <svg class="octicon octicon-plus mr-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16">
          <path d="M8 4a.75.75 0 0 1 .75.75v2.5h2.5a.75.75 0 0 1 0 1.5h-2.5v2.5a.75.75 0 0 1-1.5 0v-2.5h-2.5a.75.75 0 0 1 0-1.5h2.5v-2.5A.75.75 0 0 1 8 4Z"></path>
        </svg>
        New User
      <% end %>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="mt-5">
    <div class="Box">
      <div class="Box-header d-flex flex-items-center flex-justify-between">
        <h3 class="f4 text-semibold">Search & Filters</h3>
      </div>
      <div class="Box-body">
        <%= search_form_for @q, url: admin_users_path, method: :get do |f| %>
          <div class="d-lg-flex" style="gap: 16px;">
            <div class="flex-1 mb-3 mb-lg-0">
              <div class="form-group">
                <%= f.label :name_cont, "Name", class: "form-label" %>
                <%= f.text_field :name_cont, class: "form-control", placeholder: "Search by name..." %>
              </div>
            </div>
            <div class="flex-1 mb-3 mb-lg-0">
              <div class="form-group">
                <%= f.label :email_cont, "Email", class: "form-label" %>
                <%= f.text_field :email_cont, class: "form-control", placeholder: "Search by email..." %>
              </div>
            </div>
            <div class="flex-1 mb-3 mb-lg-0">
              <div class="form-group">
                <%= f.label :role_eq, "Role", class: "form-label" %>
                <%= f.select :role_eq, 
                    options_for_select([['All Roles', ''], ['Admin', 'admin'], ['Team Leader', 'team_leader'], ['Member', 'member']], params.dig(:q, :role_eq)), 
                    {}, 
                    class: "form-select" %>
              </div>
            </div>
          </div>
          <div class="d-flex flex-items-center mt-3" style="gap: 8px;">
            <%= f.submit "Search", class: "btn btn-primary" %>
            <%= link_to "Clear", admin_users_path, class: "btn btn-outline" %>
          </div>
        <% end %>
      </div>
  </div>

  <!-- Users Grid -->
  <div class="mt-5">
    <% if @users.any? %>
      <div class="d-lg-flex flex-wrap" style="gap: 24px;">
        <% @users.each do |user| %>
          <div class="flex-1" style="min-width: 320px; max-width: 400px;">
            <div class="mb-4 mb-lg-0">
              <%= render User::CardComponent.new(
                user: user, 
                show_admin_actions: true, 
                context: :admin
              ) %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Pagination -->
      <% if @users.total_pages > 1 %>
        <div class="d-flex flex-items-center flex-justify-center mt-5">
          <nav class="paginate-container" role="navigation" aria-label="Pagination Navigation">
            <div class="pagination">
              <% if @users.prev_page %>
                <%= link_to "Previous", admin_users_path(page: @users.prev_page, q: params[:q]), class: "previous_page" %>
              <% else %>
                <span class="previous_page disabled">Previous</span>
              <% end %>

              <% @users.total_pages.times do |page_num| %>
                <% page_num += 1 %>
                <% if page_num == @users.current_page %>
                  <em class="current"><%= page_num %></em>
                <% elsif page_num == 1 || page_num == @users.total_pages || (page_num >= @users.current_page - 2 && page_num <= @users.current_page + 2) %>
                  <%= link_to page_num, admin_users_path(page: page_num, q: params[:q]) %>
                <% elsif page_num == @users.current_page - 3 || page_num == @users.current_page + 3 %>
                  <span class="gap">â€¦</span>
                <% end %>
              <% end %>

              <% if @users.next_page %>
                <%= link_to "Next", admin_users_path(page: @users.next_page, q: params[:q]), class: "next_page" %>
              <% else %>
                <span class="next_page disabled">Next</span>
              <% end %>
            </div>
          </nav>
        </div>
      <% end %>
    <% else %>
      <%= render(Ui::EmptyStateComponent.new(
        title: "No users found",
        description: params[:q].present? ? "No users match your search criteria. Try adjusting your filters." : "Get started by creating your first user.",
        icon: "people",
        button_text: "Create User",
        button_url: new_admin_user_path
      )) %>
    <% end %>
  </div>
</div>
