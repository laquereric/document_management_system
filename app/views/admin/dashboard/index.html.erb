<% content_for :title, "Admin Dashboard" %>

<div class="container-lg px-3">
  <!-- Page Header -->
  <div class="d-flex flex-items-center flex-justify-between py-4 border-bottom">
    <div class="d-flex flex-items-center">
      <svg class="octicon octicon-gear mr-2 color-fg-accent" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="24" height="24">
        <path d="M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 10.16 1.29l.288 1.107c.018.066.079.158.212.218.906.405 1.678.961 2.26 1.543.134.134.348.134.482 0l.696-.696c.441-.441 1.057-.441 1.498 0s.441 1.057 0 1.498l-.696.696c-.134.134-.134.348 0 .482.582.582 1.138 1.354 1.543 2.26.06.133.152.194.218.212l1.107.288c.645.17 1.195.716 1.26 1.459C15.969 7.724 16 7.862 16 8s-.031.276-.069.701c-.065.743-.615 1.289-1.26 1.459l-1.107.288c-.066.018-.158.079-.218.212-.405.906-.961 1.678-1.543 2.26-.134.134-.134.348 0 .482l.696.696c.441.441.441 1.057 0 1.498s-1.057.441-1.498 0l-.696-.696c-.134-.134-.348-.134-.482 0-.582.582-1.354 1.138-2.26 1.543-.133.06-.194.152-.212.218l-.288 1.107c-.17.645-.716 1.195-1.459 1.26C8.276 15.969 8.138 16 8 16s-.276-.031-.701-.069c-.743-.065-1.289-.615-1.459-1.26l-.288-1.107c-.018-.066-.079-.158-.212-.218-.906-.405-1.678-.961-2.26-1.543-.134-.134-.348-.134-.482 0l-.696.696c-.441.441-1.057.441-1.498 0s-.441-1.057 0-1.498l.696-.696c.134-.134.134-.348 0-.482-.582-.582-1.138-1.354-1.543-2.26-.06-.133-.152-.194-.218-.212L.569 9.701C-.076 9.531-.626 8.985-.691 8.242 0.031 8.276 0 8.138 0 8s.031-.276.069-.701c.065-.743.615-1.289 1.26-1.459l1.107-.288c.066-.018.158-.079.218-.212.405-.906.961-1.678 1.543-2.26.134-.134.134-.348 0-.482L3.501 2.002c-.441-.441-.441-1.057 0-1.498s1.057-.441 1.498 0l.696.696c.134.134.348.134.482 0 .582-.582 1.354-1.138 2.26-1.543.133-.06.194-.152.212-.218L8.84.569c.17-.645.716-1.195 1.459-1.26C7.724.031 7.862 0 8 0ZM8 1.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13Zm0 2a4.5 4.5 0 1 1 0 9 4.5 4.5 0 0 1 0-9Z"></path>
      </svg>
      <div>
        <h1 class="f2 lh-condensed text-semibold mb-1">Admin Dashboard</h1>
        <p class="f5 color-fg-muted mb-0">System overview and administrative controls</p>
      </div>
    </div>
    <div class="d-flex flex-items-center gap-2">
      <span class="Label Label--danger">
        <svg class="octicon octicon-shield-check mr-1" width="16" height="16" viewBox="0 0 16 16">
          <path d="M7.467.133a1.748 1.748 0 0 1 1.066 0l5.25 1.68A1.75 1.75 0 0 1 15 3.48V7c0 1.566-.32 3.182-1.303 4.682-.983 1.498-2.585 2.813-5.032 3.855a1.697 1.697 0 0 1-1.33 0c-2.447-1.042-4.049-2.357-5.032-3.855C1.32 10.182 1 8.566 1 7V3.48a1.75 1.75 0 0 1 1.217-1.667l5.25-1.68Zm.61 1.429a.25.25 0 0 0-.153 0l-5.25 1.68a.25.25 0 0 0-.174.238V7c0 1.358.275 2.666 1.057 3.86.784 1.194 2.121 2.267 4.366 3.199a.196.196 0 0 0 .154 0c2.245-.932 3.582-2.005 4.366-3.199C12.725 9.666 13 8.358 13 7V3.48a.251.251 0 0 0-.174-.238l-5.25-1.68ZM11.28 6.28l-4.5 4.5a.75.75 0 0 1-1.06 0l-2-2a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6.25 9.19l3.97-3.97a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Z"></path>
        </svg>
        Admin Access
      </span>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="mt-4">
    <h2 class="f4 text-semibold mb-3">System Overview</h2>
    <div class="d-flex flex-wrap" style="gap: 16px;">
      <div class="flex-1" style="min-width: 240px;">
        <div class="Box p-3">
          <div class="d-flex flex-items-center">
            <div class="mr-3">
              <svg class="octicon octicon-people color-fg-accent" width="24" height="24" viewBox="0 0 16 16">
                <path d="M2 5.5a3.5 3.5 0 1 1 5.898 2.549 5.508 5.508 0 0 1 3.034 4.084.75.75 0 1 1-1.482.235 4.001 4.001 0 0 0-7.9 0 .75.75 0 0 1-1.482-.236A5.507 5.507 0 0 1 3.102 8.05 3.493 3.493 0 0 1 2 5.5ZM11 4a3.001 3.001 0 0 1 2.22 5.018 5.01 5.01 0 0 1 2.56 3.012.749.749 0 0 1-.885.954.752.752 0 0 1-.665-.57 3.51 3.51 0 0 0-2.522-2.372.75.75 0 0 1-.574-.73v-.352a.75.75 0 0 1 .416-.672A1.5 1.5 0 0 0 11 4Zm-5.5 1.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4ZM9.5 6a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"></path>
              </svg>
            </div>
            <div>
              <div class="f1 lh-condensed text-semibold"><%= @total_users %></div>
              <div class="f6 color-fg-muted">Total Users</div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-1" style="min-width: 240px;">
        <div class="Box p-3">
          <div class="d-flex flex-items-center">
            <div class="mr-3">
              <svg class="octicon octicon-organization color-fg-success" width="24" height="24" viewBox="0 0 16 16">
                <path d="M1.75 16A1.75 1.75 0 0 1 0 14.25V1.75C0 .784.784 0 1.75 0h8.5C11.216 0 12 .784 12 1.75v12.5c0 .085-.006.168-.018.25h2.268a.25.25 0 0 0 .25-.25V8.285a.25.25 0 0 0-.111-.208l-1.055-.703a.749.749 0 1 1 .832-1.248l1.055.703c.487.325.779.871.779 1.456v5.965A1.75 1.75 0 0 1 14.25 16h-3.5a.766.766 0 0 1-.197-.026c-.099.017-.2.026-.303.026h-8.5ZM3.75 4.5a.25.25 0 0 0-.25.25v.852c0 .138.112.25.25.25h.88a.25.25 0 0 0 .25-.25V4.75a.25.25 0 0 0-.25-.25h-.88ZM3.5 7.204A.25.25 0 0 1 3.75 6.96h.88a.25.25 0 0 1 .25.25v.851a.25.25 0 0 1-.25.25h-.88a.25.25 0 0 1-.25-.25V7.204ZM3.75 9.5a.25.25 0 0 0-.25.25v.851c0 .138.112.25.25.25h.88a.25.25 0 0 0 .25-.25V9.75a.25.25 0 0 0-.25-.25h-.88Zm3.5-5a.25.25 0 0 0-.25.25v.852c0 .138.112.25.25.25h.88a.25.25 0 0 0 .25-.25V4.75a.25.25 0 0 0-.25-.25h-.88ZM7 7.204a.25.25 0 0 1 .25-.244h.88a.25.25 0 0 1 .25.25v.851a.25.25 0 0 1-.25.25h-.88a.25.25 0 0 1-.25-.25V7.204ZM7.25 9.5a.25.25 0 0 0-.25.25v.851c0 .138.112.25.25.25h.88a.25.25 0 0 0 .25-.25V9.75a.25.25 0 0 0-.25-.25h-.88Z"></path>
              </svg>
            </div>
            <div>
              <div class="f1 lh-condensed text-semibold"><%= @total_organizations %></div>
              <div class="f6 color-fg-muted">Organizations</div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-1" style="min-width: 240px;">
        <div class="Box p-3">
          <div class="d-flex flex-items-center">
            <div class="mr-3">
              <svg class="octicon octicon-file-text color-fg-attention" width="24" height="24" viewBox="0 0 16 16">
                <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6H9.75A1.75 1.75 0 0 1 8 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"></path>
              </svg>
            </div>
            <div>
              <div class="f1 lh-condensed text-semibold"><%= @total_documents %></div>
              <div class="f6 color-fg-muted">Total Documents</div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-1" style="min-width: 240px;">
        <div class="Box p-3">
          <div class="d-flex flex-items-center">
            <div class="mr-3">
              <svg class="octicon octicon-file-directory color-fg-done" width="24" height="24" viewBox="0 0 16 16">
                <path d="M1.75 1A1.75 1.75 0 0 0 0 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0 0 16 13.25v-8.5A1.75 1.75 0 0 0 14.25 3H7.5a.25.25 0 0 1-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75Z"></path>
              </svg>
            </div>
            <div>
              <div class="f1 lh-condensed text-semibold"><%= @total_folders %></div>
              <div class="f6 color-fg-muted">Total Folders</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Sections -->
  <div class="mt-5">
    <div class="d-lg-flex" style="gap: 24px;">
      <!-- Users by Role -->
      <div class="flex-1 mb-4 mb-lg-0">
        <div class="Box">
          <div class="Box-header d-flex flex-items-center flex-justify-between">
            <h3 class="f4 text-semibold">Users by Role</h3>
            <%= link_to admin_users_path, class: "btn btn-sm btn-outline" do %>
              Manage Users
            <% end %>
          </div>
          <div class="Box-body">
            <% if @users_by_role.any? %>
              <div class="d-flex flex-column" style="gap: 12px;">
                <% @users_by_role.each do |role, count| %>
                  <div class="d-flex flex-items-center flex-justify-between p-2 border rounded-2">
                    <div class="d-flex flex-items-center">
                      <div class="mr-3">
                        <svg class="octicon octicon-person color-fg-muted" width="16" height="16" viewBox="0 0 16 16">
                          <path d="M10.561 8.073a6.005 6.005 0 0 1 3.432 5.142.75.75 0 1 1-1.498.07 4.5 4.5 0 0 0-8.99 0 .75.75 0 0 1-1.498-.07 6.004 6.004 0 0 1 3.431-5.142 3.999 3.999 0 1 1 5.123 0ZM10.5 5a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"></path>
                        </svg>
                      </div>
                      <span class="Label Label--<%= role == 'admin' ? 'danger' : (role == 'team_leader' ? 'attention' : 'secondary') %> mr-2">
                        <%= role.titleize %>
                      </span>
                    </div>
                    <span class="f3 text-semibold"><%= count %></span>
                  </div>
                <% end %>
              </div>
            <% else %>
              <%= render(Ui::EmptyStateComponent.new(
                title: "No user data",
                description: "User role statistics will appear here",
                icon: "people"
              )) %>
            <% end %>
          </div>
        </div>
      </div>

      <!-- Documents by Status -->
      <div class="flex-1">
        <div class="Box">
          <div class="Box-header d-flex flex-items-center flex-justify-between">
            <h3 class="f4 text-semibold">Documents by Status</h3>
            <%= link_to documents_path, class: "btn btn-sm btn-outline" do %>
              View Documents
            <% end %>
          </div>
          <div class="Box-body">
            <% if @documents_by_status.any? %>
              <div class="d-flex flex-column" style="gap: 12px;">
                <% @documents_by_status.each do |status, count| %>
                  <div class="d-flex flex-items-center flex-justify-between p-2 border rounded-2">
                    <div class="d-flex flex-items-center">
                      <div class="mr-3">
                        <svg class="octicon octicon-file-text color-fg-muted" width="16" height="16" viewBox="0 0 16 16">
                          <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6H9.75A1.75 1.75 0 0 1 8 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"></path>
                        </svg>
                      </div>
                      <span class="Label Label--secondary mr-2"><%= status %></span>
                    </div>
                    <span class="f3 text-semibold"><%= count %></span>
                  </div>
                <% end %>
              </div>
            <% else %>
              <%= render(Ui::EmptyStateComponent.new(
                title: "No document data",
                description: "Document status statistics will appear here",
                icon: "file-text"
              )) %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Activity Section -->
  <div class="mt-5">
    <div class="Box">
      <div class="Box-header d-flex flex-items-center flex-justify-between">
        <h3 class="f4 text-semibold">Recent Activity</h3>
        <%= link_to activities_path, class: "btn btn-sm btn-outline" do %>
          View All Activity
        <% end %>
      </div>
      <div class="Box-body">
        <% if @recent_activity.any? %>
          <div class="Timeline">
            <% @recent_activity.each do |activity| %>
              <div class="TimelineItem">
                <div class="TimelineItem-badge">
                  <% case activity.action %>
                  <% when 'created' %>
                    <svg class="octicon octicon-plus color-fg-success" width="16" height="16" viewBox="0 0 16 16">
                      <path d="M8 2a.75.75 0 0 1 .75.75v4.5h4.5a.75.75 0 0 1 0 1.5h-4.5v4.5a.75.75 0 0 1-1.5 0v-4.5h-4.5a.75.75 0 0 1 0-1.5h4.5v-4.5A.75.75 0 0 1 8 2Z"></path>
                    </svg>
                  <% when 'updated' %>
                    <svg class="octicon octicon-pencil color-fg-accent" width="16" height="16" viewBox="0 0 16 16">
                      <path d="M11.013 1.427a1.75 1.75 0 0 1 2.474 0l1.086 1.086a1.75 1.75 0 0 1 0 2.474l-.897.897a.75.75 0 0 1-.53.22H13.25a.75.75 0 0 1-.75-.75v-1.5a.75.75 0 0 0-.75-.75h-1.5a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 1-.75.75H9.5a.75.75 0 0 1-.53-.22l-.897-.897a1.75 1.75 0 0 1 0-2.474l1.086-1.086Z"></path>
                    </svg>
                  <% else %>
                    <svg class="octicon octicon-pulse color-fg-muted" width="16" height="16" viewBox="0 0 16 16">
                      <path d="M6 2c.306 0 .582.187.696.471L10 10.731l1.304-3.26A.751.751 0 0 1 12 7h3.25a.75.75 0 0 1 0 1.5H12.58l-1.855 4.64a.751.751 0 0 1-1.393-.011L6 5.069 4.696 8.329A.751.751 0 0 1 4 8.5H.75a.75.75 0 0 1 0-1.5h2.68l1.85-4.629A.751.751 0 0 1 6 2Z"></path>
                    </svg>
                  <% end %>
                </div>
                <div class="TimelineItem-body">
                  <div class="d-flex flex-items-center flex-justify-between">
                    <div class="flex-1">
                      <div class="d-flex flex-items-center gap-2 mb-1">
                        <span class="f6 text-semibold"><%= activity.user&.name || 'Unknown User' %></span>
                        <span class="f6 color-fg-muted"><%= activity.action.humanize.downcase %></span>
                        <% if activity.document %>
                          <%= link_to activity.document.title, document_path(activity.document), class: "Link--primary f6" %>
                        <% end %>
                      </div>
                      <% if activity.notes.present? %>
                        <div class="f6 color-fg-muted">
                          <%= activity.notes %>
                        </div>
                      <% end %>
                    </div>
                    <div class="f6 color-fg-muted">
                      <%= time_ago_in_words(activity.created_at) %> ago
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <%= render(Ui::EmptyStateComponent.new(
            title: "No recent activity",
            description: "System activity will appear here as users interact with documents",
            icon: "pulse"
          )) %>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Quick Actions Section -->
  <div class="mt-5">
    <div class="Box">
      <div class="Box-header">
        <h3 class="f4 text-semibold">Quick Actions</h3>
      </div>
      <div class="Box-body">
        <div class="d-flex flex-wrap" style="gap: 12px;">
          <%= link_to admin_users_path, class: "btn btn-outline" do %>
            <svg class="octicon octicon-people mr-2" width="16" height="16" viewBox="0 0 16 16">
              <path d="M2 5.5a3.5 3.5 0 1 1 5.898 2.549 5.508 5.508 0 0 1 3.034 4.084.75.75 0 1 1-1.482.235 4.001 4.001 0 0 0-7.9 0 .75.75 0 0 1-1.482-.236A5.507 5.507 0 0 1 3.102 8.05 3.493 3.493 0 0 1 2 5.5ZM11 4a3.001 3.001 0 0 1 2.22 5.018 5.01 5.01 0 0 1 2.56 3.012.749.749 0 0 1-.885.954.752.752 0 0 1-.665-.57 3.51 3.51 0 0 0-2.522-2.372.75.75 0 0 1-.574-.73v-.352a.75.75 0 0 1 .416-.672A1.5 1.5 0 0 0 11 4Zm-5.5 1.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4ZM9.5 6a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"></path>
            </svg>
            Manage Users
          <% end %>
          <%= link_to organizations_path, class: "btn btn-outline" do %>
            <svg class="octicon octicon-organization mr-2" width="16" height="16" viewBox="0 0 16 16">
              <path d="M1.75 16A1.75 1.75 0 0 1 0 14.25V1.75C0 .784.784 0 1.75 0h8.5C11.216 0 12 .784 12 1.75v12.5c0 .085-.006.168-.018.25h2.268a.25.25 0 0 0 .25-.25V8.285a.25.25 0 0 0-.111-.208l-1.055-.703a.749.749 0 1 1 .832-1.248l1.055.703c.487.325.779.871.779 1.456v5.965A1.75 1.75 0 0 1 14.25 16h-3.5a.766.766 0 0 1-.197-.026c-.099.017-.2.026-.303.026h-8.5ZM3.75 4.5a.25.25 0 0 0-.25.25v.852c0 .138.112.25.25.25h.88a.25.25 0 0 0 .25-.25V4.75a.25.25 0 0 0-.25-.25h-.88ZM3.5 7.204A.25.25 0 0 1 3.75 6.96h.88a.25.25 0 0 1 .25.25v.851a.25.25 0 0 1-.25.25h-.88a.25.25 0 0 1-.25-.25V7.204ZM3.75 9.5a.25.25 0 0 0-.25.25v.851c0 .138.112.25.25.25h.88a.25.25 0 0 0 .25-.25V9.75a.25.25 0 0 0-.25-.25h-.88Zm3.5-5a.25.25 0 0 0-.25.25v.852c0 .138.112.25.25.25h.88a.25.25 0 0 0 .25-.25V4.75a.25.25 0 0 0-.25-.25h-.88ZM7 7.204a.25.25 0 0 1 .25-.244h.88a.25.25 0 0 1 .25.25v.851a.25.25 0 0 1-.25.25h-.88a.25.25 0 0 1-.25-.25V7.204ZM7.25 9.5a.25.25 0 0 0-.25.25v.851c0 .138.112.25.25.25h.88a.25.25 0 0 0 .25-.25V9.75a.25.25 0 0 0-.25-.25h-.88Z"></path>
            </svg>
            Manage Organizations
          <% end %>
          <%= link_to documents_path, class: "btn btn-outline" do %>
            <svg class="octicon octicon-file-text mr-2" width="16" height="16" viewBox="0 0 16 16">
              <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6H9.75A1.75 1.75 0 0 1 8 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"></path>
            </svg>
            View All Documents
          <% end %>
          <%= link_to admin_teams_path, class: "btn btn-outline" do %>
            <svg class="octicon octicon-people mr-2" width="16" height="16" viewBox="0 0 16 16">
              <path d="M2 5.5a3.5 3.5 0 1 1 5.898 2.549 5.508 5.508 0 0 1 3.034 4.084.75.75 0 1 1-1.482.235 4.001 4.001 0 0 0-7.9 0 .75.75 0 0 1-1.482-.236A5.507 5.507 0 0 1 3.102 8.05 3.493 3.493 0 0 1 2 5.5ZM11 4a3.001 3.001 0 0 1 2.22 5.018 5.01 5.01 0 0 1 2.56 3.012.749.749 0 0 1-.885.954.752.752 0 0 1-.665-.57 3.51 3.51 0 0 0-2.522-2.372.75.75 0 0 1-.574-.73v-.352a.75.75 0 0 1 .416-.672A1.5 1.5 0 0 0 11 4Zm-5.5 1.5a2 2 0 1 0 0 4 2 2 0 0 0 0-4ZM9.5 6a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z"></path>
            </svg>
            Manage Teams
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
