<% content_for :title, "Activity Logs" %>

<%= render(Layout::PageContent.new(padding: :none)) do %>
  <!-- Page Header -->
  <%= render(Layout::PageHeader.new(
    title: "Activity Logs",
    description: "Track and monitor system activity and document changes",
    icon: "pulse"
  )) %>

  <!-- Statistics Cards -->
  <%= render(Layout::StatisticsGrid.new(
    title: "Activity Overview",
    statistics: [
      {
        title: "Total Activities",
        value: @activity_logs.respond_to?(:total_count) ? @activity_logs.total_count : @activity_logs.count,
        icon: "pulse",
        color: "accent"
      },
      {
        title: "Last 24 Hours",
        value: ActivityLog.where('created_at >= ?', 24.hours.ago).count,
        icon: "calendar",
        color: "success"
      },
      {
        title: "Active Users",
        value: ActivityLog.joins(:user).distinct.count('activity_logs.user_id'),
        icon: "person",
        color: "attention"
      },
      {
        title: "Status Changes",
        value: ActivityLog.where(action: 'status_change').count,
        icon: "arrow-switch",
        color: "done"
      }
    ]
  )) %>

  <!-- Search and Filters -->
  <%= render(Layout::SearchSection.new) do %>
    <%= search_form_for @q, url: activity_logs_path, method: :get, class: "d-flex flex-items-center gap-3" do |f| %>
      <div class="flex-1">
        <%= f.label :action_cont, "Action", class: "form-label sr-only" %>
        <%= f.text_field :action_cont, class: "form-control", placeholder: "Search by action..." %>
      </div>
      <div class="flex-1">
        <%= f.label :document_title_cont, "Document", class: "form-label sr-only" %>
        <%= f.text_field :document_title_cont, class: "form-control", placeholder: "Filter by document..." %>
      </div>
      <div class="flex-1">
        <%= f.label :user_name_cont, "User", class: "form-label sr-only" %>
        <%= f.text_field :user_name_cont, class: "form-control", placeholder: "Filter by user..." %>
      </div>
      <div>
        <%= f.submit "Search", class: "btn btn-primary" %>
      </div>
      <div>
        <%= link_to "Clear", activity_logs_path, class: "btn" %>
      </div>
    <% end %>
  <% end %>

  <!-- Activity Logs Section -->
  <%= render(Layout::ContentSection.new(
    title: "Recent Activity",
    count: @activity_logs.respond_to?(:total_count) ? @activity_logs.total_count : @activity_logs.count
  )) do %>
    <% if @activity_logs.any? %>
      <%= render(ActivityLogs::TimelineComponent.new(activity_logs: @activity_logs)) %>

      <!-- Pagination -->
      <% if @activity_logs.respond_to?(:current_page) %>
        <%= render(Layout::CardListPagination.new(collection: @activity_logs)) %>
      <% end %>
    <% else %>
      <%= render(Ui::EmptyStateComponent.new(
        title: "No Activity Found",
        description: params[:q]&.values&.any?(&:present?) ? 
          "Try adjusting your search criteria" : 
          "Activity will appear here as users interact with documents",
        icon: "pulse"
      )) %>
    <% end %>
  <% end %>
<% end %>
