<% content_for :title, "#{@user.name}'s Activities" %>

<%= render(Layout::PageContent.new(padding: :none)) do %>
  <!-- Page Header -->
  <%= render(Layout::PageHeader.new(
    title: "#{@user.name}'s Activities",
    description: "Track and monitor activity and document changes for #{@user.name}",
    icon: "pulse"
  )) %>

  <!-- Statistics Cards -->
  <%= render(Layout::StatisticsGrid.new(
    title: "Activity Overview",
    statistics: [
      {
        title: "Total Activities",
        value: @activities.respond_to?(:total_count) ? @activities.total_count : @activities.count,
        icon: "pulse",
        color: "accent"
      },
      {
        title: "Last 24 Hours",
        value: @user.activities.where('created_at >= ?', 24.hours.ago).count,
        icon: "calendar",
        color: "success"
      },
      {
        title: "Documents Modified",
        value: @user.activities.joins(:document).distinct.count('activities.document_id'),
        icon: "file-text",
        color: "attention"
      },
      {
        title: "Status Changes",
        value: @user.activities.where(action: 'status_change').count,
        icon: "arrow-switch",
        color: "done"
      }
    ]
  )) %>

  <!-- Search and Filters -->
  <%= render(Layout::SearchSection.new) do %>
    <%= search_form_for @q, url: user_activities_path(@user), method: :get, class: "d-flex flex-items-center gap-3" do |f| %>
      <div class="flex-1">
        <%= f.label :action_cont, "Action", class: "form-label sr-only" %>
        <%= f.text_field :action_cont, class: "form-control", placeholder: "Search by action..." %>
      </div>
      <div class="flex-1">
        <%= f.label :document_title_cont, "Document", class: "form-label sr-only" %>
        <%= f.text_field :document_title_cont, class: "form-control", placeholder: "Filter by document..." %>
      </div>
      <div class="flex-1">
        <%= f.label :user_name_cont, "User", class: "form-label sr-only" %>
        <%= f.text_field :user_name_cont, class: "form-control", placeholder: "Filter by user..." %>
      </div>
      <div>
        <%= f.submit "Search", class: "btn btn-primary" %>
      </div>
      <div>
        <%= link_to "Clear", user_activities_path(@user), class: "btn" %>
      </div>
    <% end %>
  <% end %>

  <!-- Activity Logs Section -->
  <%= render(Layout::ContentSection.new(
    title: "Recent Activity",
    count: @activities.respond_to?(:total_count) ? @activities.total_count : @activities.count
  )) do %>
    <% if @activities.any? %>
      <%= render(Activities::TimelineComponent.new(activities: @activities)) %>

      <!-- Pagination -->
      <% if @activities.respond_to?(:current_page) %>
        <%= render(Layout::CardListPaginationComponent.new(collection: @activities)) %>
      <% end %>
    <% else %>
      <%= render(Ui::EmptyStateComponent.new(
        title: "No Activity Found",
        description: params[:q]&.values&.any?(&:present?) ? 
          "Try adjusting your search criteria" : 
          "Activity will appear here as users interact with documents",
        icon: "pulse"
      )) %>
    <% end %>
  <% end %>
<% end %>
